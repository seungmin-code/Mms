<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>점검예약</title>
  <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      margin-top: 20px;
      color: #333;
    }

    #reservationForm {
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }

    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
      box-sizing: border-box;
    }

    input:focus, select:focus, textarea:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
    }

    textarea {
      resize: none;
    }

    button {
      background-color: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #0056b3;
    }

    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    #other_reason_label,
    #other_reason {
      display: none; /* 기본적으로 숨김 처리 */
    }
  </style>

  <script>
    $(function() {
      // 점검사유 기타 옵션을 선택했을때 라벨과 텍스트 영역 활성화
      $("#check_reason").on('change', function() {
        const $otherReasonLabel = $('#other_reason_label');
        const $otherReason = $('#other_reason');

        if ($(this).val() === 'other') {
          $otherReasonLabel.show();
          $otherReason.show();
          $otherReason.prop('disabled', false);
        } else {
          $otherReasonLabel.hide();
          $otherReason.hide();
          $otherReason.prop('disabled', true);
        }
      });

      // 폼 제출 처리
      $('#reservationForm').on('submit', function(e) {
        e.preventDefault(); // 기본 폼 제출을 방지

        let formData = $("#reservationForm").serializeArray();
        let data = {};
        formData.forEach(function(item) {
          data[item.name] = item.value;
        });

        $.ajax({
          url: '/reservation/create',
          type: 'POST',
          dataType: 'json',
          contentType: 'application/json; charset=utf-8',
          data: JSON.stringify(data),
          success: function(response) {
            alert('예약 성공');
            location.reload();
          },
          error: function(xhr) {
            let errorMessage = '예약 실패';
            if (xhr.status === 400) {
              errorMessage = xhr.responseJSON ? xhr.responseJSON.message : errorMessage;
            } else if (xhr.status === 500) {
              errorMessage = '서버 오류가 발생했습니다.';
            } else if (xhr.status === 404) {
              errorMessage = '요청한 페이지를 찾을 수 없습니다.';
            }
            alert(errorMessage);
            console.log(xhr);
          }
        });
      });
    });
  </script>
</head>
<body>
<div>
  <h1>점검예약</h1>
  <form id="reservationForm" name="reservationForm">

    <label for="check_date">점검날짜</label>
    <input type="date" id="check_date" name="check_date">

    <label for="check_time">점검시간</label>
    <input type="time" id="check_time" name="check_time">

    <label for="check-type">점검종류</label>
    <select id="check-type" name="check_type">
      <option value="periodic_check" selected>수시점검</option>
      <option value="regular_check">정기점검</option>
      <option value="emergency_check">긴급점검</option>
    </select>

    <label for="device">점검대상</label>
    <select id="device" name="device">
      <option value="equipment1">장비1</option>
      <option value="equipment2">장비2</option>
      <option value="equipment3">장비3</option>
    </select>

    <label for="check_reason">점검사유</label>
    <select id="check_reason" name="check_reason">
      <option value="maintenance">정기 유지보수</option>
      <option value="fault">고장 및 장애</option>
      <option value="upgrade">시스템 업그레이드</option>
      <option value="performance">성능 최적화</option>
      <option value="security">보안 점검</option>
      <option value="other">기타 (세부 사유 입력)</option>
    </select>

    <label id="other_reason_label" for="other_reason">기타 점검 사유</label>
    <textarea id="other_reason" name="other_reason" rows="4" placeholder="기타 점검 사유를 입력해주세요" disabled></textarea>

    <label for="assignee">담당자</label>
    <input type="text" id="assignee" name="assignee" placeholder="담당자명">

    <label for="contact">담당자 연락처</label>
    <input type="tel" id="contact" name="contact" placeholder="전화번호">

    <button type="submit">저장</button>
  </form>
</div>
</body>
</html>
